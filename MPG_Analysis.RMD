---
title: "Talking Transmissions-Impacts on Fuel Economy"
author: "Larkin O'Hern"
date: "July 13, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(plyr)
library(gridExtra)

```
###Executive Summary
This analysis will explore the relationship between fuel economy-measured as miles per gallon-and vehicle transmission type-either automatic or manual to determine:    
1. Is an automatic or manual transmission better for MPG?    
2. The quantitative MPG difference between automatic and manual transmissions.    

###Exploratory Data Analysis 
```{r echo=F, include=F}

data("mtcars")
str(mtcars)
summary(mtcars$mpg)
head(mtcars)

table(mtcars$am)
summary(mtcars$mpg)
plot(mtcars$mpg)

###get trans type as a factor 
mtcars$am<-factor(mtcars$am)
levels(mtcars$am)<-c("auto","manual")

###Lets add vehicle type as a variable just for fun
mtcars$model<-row.names(mtcars)
```
The mtcars data contains observations on 11 design and performance characteristics of 32 cars drawn from the 1974 Motor Trend US magazine.  I will focus primarily on transmission type (manual vs automatic) and fuel economy (in miles per gallon).  The cars in the data set are almost evenly split between manual (13) and automatic (19) giving plenty of observations for each. Fuel economy ranges from 10.4-33.9 MPG with a mean 20.09 and median 19.02.  If we condition on transmission type stark difference emerge.  

```{r echo=FALSE, warning=F, message=FALSE,fig.width=10, eval=TRUE }

g1<-ggplot(mtcars, aes(x=am, y=mpg ))
g1<-g1+geom_boxplot(notch = F)+xlab("Transmission Type")+ylab("Fuel Economy (Miles Per Gallon)")+ggtitle("MPG by Transmision Type")+stat_summary(fun.y = "mean",shape=23, size=2, fill="white")

g<-ggplot(mtcars, aes(y=mpg, x=reorder(model, mpg, sum), color=am))+geom_point()+xlab("Index")+theme(axis.text.x=element_text(angle=70, hjust=1, vjust=1))+xlab("Model")+ylab("Fuel Economy (Miles Per Gallon)")+ggtitle("MPG by Transmision Type")+labs(color="Transmission")

grid.arrange(g1, g, ncol=2)

###looks like a big difference in both center and spread based on transmission type.  Manual transmissions have higher average mpg and greater variability
```
From the histogram we see that cars with manual transmissions have higher average fuel economy and great variability. From the scatter plot we see that almost all f the low fuel economy cars are automatics while most of the high fuel economy cars are manual.

We can use a quick t test to determine whether the difference in means is statistically significant.
```{r echo=FALSE, include=FALSE, warning=F, message=FALSE,eval=TRUE }
auto<-subset(mtcars, am=="auto")
manual<-subset(mtcars, am=="manual")
test<-t.test(auto$mpg, manual$mpg, paired = FALSE)
```

Zero is not included in our confidence interval (`r test$conf`) and our p-value (`r test$p.value`) is below .05 so transmission type appears to make a statistically significant difference in fuel economy. 


###Model Selection
To quantify the effect of transmission type on fuel economy we will fit a series of linear models of increasing complexity.

The simplest model examines transmission type as the only predictor of mpg.

```{r echo=FALSE, include=TRUE, warning=F, message=FALSE,eval=TRUE}
fit<-lm(mpg~am, mtcars)

summary(fit)

confint(fit)
```
This basic model confirms that transmission type is a significant predictor and the coefficient for transmission type indicates an increase of 7.25 MPG for vehicles with manual transmissions versus those with automatic transmission-all else being equal. Expanding our point prediction to encompasses a 95% confidence interval gives us an expected increase of 3.4 to 10.84 mpg in cars with manual transmissions.  

However, transmission type explain only about 35% of the variance in MPG-so there are likley other significant variables that could add explanatory power to our model. 

Here I fit five additional models each with one additional predictor or interaction between transmission type and predictor (nested models) and compare them using ANOVA.  

``````{r echo=FALSE, include=TRUE, warning=F, message=FALSE,eval=TRUE}
###test nested models
fit1<-lm(mpg~am,data=mtcars)
fit2<-update(fit1, mpg~am+wt)
fit3<-update(fit2, mpg~am+wt+am:wt)
fit4<-update(fit3, mpg~am+wt+am:wt+hp)
fit5<-update(fit4, mpg~am+wt+disp+hp+am:wt)
fit6<-update(fit5, mpg~am+wt+disp+hp+am:wt+cyl)
fit7<-update(fit6, mpg~am+wt+disp+hp+am:wt+cyl+gear)
```
```{r echo=FALSE, include=TRUE, warning=F, message=FALSE,eval=TRUE}

anova(fit1,fit2,fit3,fit4, fit5, fit6, fit7)
```
Vehicle weight and the interaction of weight and transmission type add predictive power-the other variables do not.

I've re-fit the model using the significant predictors to generate a new estimate of the impact of transmission type after accounting for the other key variables.

```{r echo=FALSE, include=TRUE, warning=F, message=FALSE,eval=TRUE}

summary(fit3)
confint(fit3)
```

The new model suggest that manual transmissions add 14.8 MPG versus automatics with a 95% confidence that the true gain is between 6.14 and 23.61 MPG.  Thats signficntly wider-espcially ro the high side than our first model.  Vehicle weight and the intereaction of weight and transmission type are both associate with decreased fl econmy whih makes sense-heavier objects should take more energy to move.  This model exlaines 83% of the variance in MPG a large improvment from our transmission only model.


###Residual Diagnostics 



        



